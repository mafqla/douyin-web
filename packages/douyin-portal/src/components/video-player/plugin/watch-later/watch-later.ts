import { Plugin, Util } from 'xgplayer'
import './index.scss'
import type { IPluginOptions } from 'xgplayer/es/plugin/plugin'

const { POSITIONS } = Plugin

class watchLater extends Plugin {
  hasShownMessage: boolean
  static get pluginName() {
    return 'watchLater'
  }

  static get defaultConfig() {
    return {
      position: POSITIONS.CONTROLS_RIGHT,
      index: 5.6,
      className: 'xgplayer-watch-later',
      text: '稍后再看'
    }
  }

  constructor(args: IPluginOptions | undefined) {
    super(args)
    this.hasShownMessage = false
  }

  afterCreate() {
    const eventName = Util.checkTouchSupport() ? 'touchend' : 'click'
    this.bind(eventName, this.onClick)
  }
  onClick = () => {
    if (!this.hasShownMessage) {
      this.hasShownMessage = true
      const text = '添加成功，可在-我的- 稍后再看中查看'
      this.emit('watch-later', text)
    } else {
      const textEd = '已添加过该视频'
      this.emit('watch-later', textEd)
    }
  }

  destroy() {
    // this.unbind('click', this.onClick)
    // 播放器销毁的时候一些逻辑
  }

  render() {
    return `<xg-icon class="xgplayer-watch-later" data-state="normal">
    <div class="xgplayer-watch-later-item xgplayer-icon" > 
    <svg
      viewBox="0 0 32 32"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
      width="32"
      height="32"
      focusable="false"
    >
      <path
        fill-rule="evenodd"
        clip-rule="evenodd"
        d="M12.5625 7.69012H12.5086H12.5085H12.5085C11.1499 7.69011 10.0542 7.6901 9.17514 7.77953C8.26773 7.87183 7.48079 8.06763 6.78465 8.53278C6.2387 8.89757 5.76995 9.36632 5.40515 9.91228C4.94 10.6084 4.74421 11.3954 4.6519 12.3028C4.56247 13.1819 4.56249 14.2775 4.5625 15.6362V15.6362V15.6362V15.6901V15.7441V15.7441V15.7441C4.56249 17.1028 4.56247 18.1984 4.6519 19.0775C4.74421 19.9849 4.94 20.7718 5.40515 21.468C5.76995 22.0139 6.2387 22.4827 6.78465 22.8475C7.48079 23.3126 8.26773 23.5084 9.17514 23.6007C10.0542 23.6902 11.1498 23.6901 12.5084 23.6901H12.5086H12.5625H15.976C15.4986 23.0954 15.1164 22.421 14.8523 21.6901H12.5625C11.1372 21.6901 10.1435 21.6889 9.37755 21.611C8.62828 21.5348 8.20854 21.3935 7.89579 21.1845C7.56822 20.9657 7.28697 20.6844 7.06809 20.3568C6.85912 20.0441 6.71785 19.6243 6.64163 18.8751C6.56371 18.1091 6.5625 17.1154 6.5625 15.6901C6.5625 14.2649 6.56371 13.2712 6.64163 12.5052C6.71785 11.7559 6.85912 11.3362 7.06809 11.0234C7.28697 10.6958 7.56822 10.4146 7.89579 10.1957C8.20854 9.98674 8.62828 9.84548 9.37755 9.76926C10.1435 9.69134 11.1372 9.69013 12.5625 9.69013H15.7563C17.088 9.69013 18.0164 9.69119 18.7346 9.75961C19.4378 9.82662 19.8352 9.95106 20.1331 10.1341C20.5344 10.3807 20.8719 10.7183 21.1185 11.1195C21.2826 11.3865 21.3996 11.7335 21.4703 12.3088C22.1794 12.3119 22.8636 12.4204 23.508 12.6194C23.501 12.5197 23.493 12.4227 23.484 12.3283C23.403 11.4784 23.2315 10.738 22.8225 10.0725C22.4116 9.40368 21.8489 8.84105 21.1802 8.4301C20.5147 8.02117 19.7742 7.84962 18.9243 7.76863C18.1001 7.6901 17.0763 7.69011 15.8067 7.69012H15.8067H15.8066H15.7563H12.5625ZM21.438 14.3088C18.6763 14.3088 16.4375 16.5476 16.4375 19.3093C16.4375 22.0711 18.6763 24.3099 21.438 24.3099C24.1998 24.3099 26.4386 22.0711 26.4386 19.3093C26.4386 16.5476 24.1998 14.3088 21.438 14.3088ZM19.6545 20.0287L19.6545 20.0346V20.0346C19.6543 20.063 19.6537 20.1585 19.665 20.2503C19.6802 20.3741 19.7284 20.6155 19.9237 20.8406C19.9577 20.8798 19.9944 20.9165 20.0336 20.9505C20.2586 21.1458 20.5001 21.194 20.6239 21.2092C20.7157 21.2204 20.8112 21.2199 20.8396 21.2197H20.8396L20.8455 21.2197H23.1545H24.1545V19.2197H23.1545H21.6545V17.7197V16.7197H19.6545V17.7197V20.0287ZM11.5723 13.5339C11.3125 13.8199 11.3125 14.36 11.3125 15.4401C11.3125 16.5203 11.3125 17.0603 11.5723 17.3463C11.7161 17.5047 11.907 17.6127 12.1168 17.6546C12.4957 17.7302 12.9588 17.4524 13.885 16.8966L13.885 16.8966C14.7657 16.3682 15.206 16.104 15.321 15.7457C15.3848 15.547 15.3848 15.3333 15.321 15.1345C15.206 14.7762 14.7657 14.512 13.885 13.9836C12.9588 13.4279 12.4957 13.15 12.1168 13.2257C11.907 13.2675 11.7161 13.3756 11.5723 13.5339Z"
        fill="currentColor"
      ></path>
    </svg>
    </div>
      <div class="xgTips"> 
        <span>${this.config.text}</span>
        <span class="shortcutKey">L</span>
      </div>
     </xg-icon>`
  }
}

export default watchLater
